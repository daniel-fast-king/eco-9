<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Book Viewer ‚Äî Lazy 30 pages</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root { --page-w: 538px; --page-h: 758px; --page-gap: 20px; }

html,body { height:100%; margin:0; background:#111; font-family:Arial, sans-serif; color:#eee; }
body {
  display:flex; justify-content:center; align-items:flex-start;
  overflow:hidden;
  padding:12px;
}

.book-container {
  width:100%;
  max-width: calc(var(--page-w) + 80px);
  height: calc(100vh - 24px);
  overflow-y:auto;
  padding:24px;
  box-sizing:border-box;
  -webkit-overflow-scrolling: touch;
  scrollbar-width:none;
}
.book-container::-webkit-scrollbar { display:none; }

.zoom-scroll-area { width:100%; display:block; text-align:center; }
.zoom-wrapper {
  display:block;
  margin:0 auto;
  transform-origin: top center;
  transition: transform .18s ease;
  width: var(--page-w);
}

.page {
  width: var(--page-w);
  height: var(--page-h);
  margin: var(--page-gap) auto;
  position: relative;
  overflow: hidden;
  background: transparent;
}
.page img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: transparent;
  user-select: none;
  -webkit-user-drag: none;
}
.page .ph {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#444;
  font-weight:600;
  font-size:14px;
  background:linear-gradient(90deg, #eee, #ddd);
  opacity:.6;
}

.page-indicator {
  position:fixed;
  right:12px;
  width:60px;
  height:34px;
  top:12px;
  background:#5bd1ec;
  color:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:10px 0 0 10px;
  box-shadow: 0 8px 20px rgba(0,0,0,.6);
  font-weight:700;
  z-index:9999;
}

.toolbar {
  position: fixed;
  bottom: 3vh;
  left: 50%;
  transform: translateX(-50%) translateY(20%);
  background: rgba(30, 30, 30, 0.95);
  border-radius: 2vw;
  padding: 2vh 3vw; 
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: calc(var(--page-w) + 120px); 
  box-shadow: 0 0.5vh 2vh rgba(0,0,0,0.4);
  z-index: 1000;
  font-size: 1.2vw;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.toolbar.visible {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
  pointer-events: auto;
}
.toolbar button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5vw;
  padding: 0.8vh 1.2vw;
  border: none;
  border-radius: 1vw;
  background: #2a2a2a;
  color: #fff;
  cursor: pointer;
  transition: 0.2s;
  font-size: 1vw;
}
.toolbar input {
  width: 10vw;
  text-align: center;
  border-radius: 0.8vw;
  border: 0.2vh solid #555;
  background: #1e1e1e;
  color: #fff;
  padding: 0.6vh 0.6vw;
  font-size: 1vw;
  margin-bottom: 0.6vh; 
}

.page-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5vh;
}

.flex { display: flex; align-items: center; }
.gap-1 { gap: 4px; }
.gap-2 { gap: 8px; }

.toggle {
  position: relative;
  width: 44px;
  height: 14px;
  background: #555;
  border-radius: 999px;
  cursor: pointer;
  transition: background 0.3s;
}
.toggle-circle {
  margin-top:-4px;
  position: absolute;
  top: 2px;
  left: 2px;
  width: 18px;
  height: 18px;
  background: #fff;
  border-radius: 50%;
  transition: transform 0.3s;
}
.toggle.active { background:#ff9800; }
.toggle.active .toggle-circle { transform: translateX(22px); }

#chapterBoxes {
  overflow-y: auto;
  padding-right: 1vw;
}
#chapterBoxes::-webkit-scrollbar { width:6px; }
#chapterBoxes::-webkit-scrollbar-thumb { background:#555; border-radius:3px; }
</style>
</head>
<body>

<div class="book-container" id="bookContainer" tabindex="0">
  <div class="zoom-scroll-area">
    <div class="zoom-wrapper" id="zoomWrapper"></div>
  </div>
</div>

<div id="pageIndicator" class="page-indicator">1</div>

<div id="toolbar" class="toolbar">
  <div class="flex gap-2">
    <button>üìë Chapters</button>
  </div>
  <div class="flex gap-1">
    <input id="pageInput" type="text" value="1 / 817">
    <button id="goButton">Go</button>
  </div>

  <div class="flex gap-2">
    <span>‚òÄÔ∏è</span>
    <div id="themeToggle" class="toggle"><div class="toggle-circle"></div></div>
    <span>üåô</span>
  </div>
</div>

<div id="chaptersPopup" style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    max-width: 550px;
    max-height: 460px;
    height: 69vh;
    background: rgba(7, 10, 16, 0.72);
    color: #fff;
    border-radius: 1rem;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    display: none;
    z-index: 2000;
    overflow: hidden;
    padding: 2%;
">
  <button id="closeChapters" style="
      position: absolute;
      top: 1%;
      right: 8%;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 2vw;
      cursor: pointer;
  ">√ó</button>
  <div id="chapterBoxes" style="
      position: relative;
      width: 98%;
      height: 100%;
  "></div>
</div>

<script>
const BASE_PATH = 'https://raw.githubusercontent.com/daniel-fast-king/eco-9/main';
const BUFFER = 3;
let scale = 1;
let darkMode = false;

// All pages before page-008 will show as "*"
const FILES = [
  '_1.webp','_2.webp','_3.webp','_4.webp','_5.webp','_6.webp','_7.webp',
  ...Array.from({length: 111}, (_, i) => `page-${String(i+1).padStart(3,'0')}.webp`)
];

const TOTAL_PAGES = FILES.length;

const bookContainer = document.getElementById('bookContainer');
const zoomWrapper = document.getElementById('zoomWrapper');
const pageIndicator = document.getElementById('pageIndicator');
const themeToggle = document.getElementById('themeToggle');
const pageInput = document.getElementById('pageInput');
const goButton = document.getElementById('goButton');

const pages = [];
let isEditing = false;

// --- Create placeholders ---
for(let i=1;i<=TOTAL_PAGES;i++){
  const pageDiv=document.createElement('div');
  pageDiv.className='page';
  pageDiv.dataset.index=i;
  const ph=document.createElement('div');
  ph.className='ph';
  ph.textContent=`page ${i}`;
  pageDiv.appendChild(ph);
  zoomWrapper.appendChild(pageDiv);
  pages.push(pageDiv);
}

// --- Helpers ---
function getPageLabel(pageNum){
  const f=FILES[pageNum-1]||'';
  if(f==='*.webp') return '*';
  if(f.startsWith('page-')) return String(parseInt(f.match(/page-(\d+)/)[1],10));
  return f.replace(/\.webp$/i,'');
}

function parsePageSpecifier(val){
  if(!val && val!==0) return NaN;
  const s=String(val).trim().toUpperCase();
  for(let i=0;i<FILES.length;i++){
    if(getPageLabel(i+1)===s) return i+1;
  }
  if(/^\d+$/.test(s)){
    const n=parseInt(s,10);
    for(let i=0;i<FILES.length;i++){
      if(FILES[i].startsWith('page-')){
        const p=parseInt(FILES[i].match(/page-(\d+)/)[1],10);
        if(p===n) return i+1;
      }
    }
    return NaN;
  }
  return NaN;
}

// --- Page load/unload ---
function loadPage(pageNum){
  const pageDiv=pages[pageNum-1];
  if(!pageDiv || pageDiv.querySelector('img')) return;
  const file=FILES[pageNum-1];
  if(file==='*.webp') return; // don't load placeholder
  const img=document.createElement('img');
  img.src=`${BASE_PATH}/${file}`;
  img.style.transition='none';
  img.style.filter=darkMode?'invert(1) brightness(0.95) contrast(1.1)':'none';
  img.onload=()=>{ const ph=pageDiv.querySelector('.ph'); if(ph) ph.remove(); };
  img.onerror=()=>{ const ph=pageDiv.querySelector('.ph'); if(ph) ph.textContent=`missing: ${pageNum}`; };
  pageDiv.appendChild(img);
}

function unloadPage(pageNum){
  const pageDiv=pages[pageNum-1];
  if(!pageDiv) return;
  const img=pageDiv.querySelector('img'); if(img) img.remove();
  if(!pageDiv.querySelector('.ph')){
    const ph=document.createElement('div');
    ph.className='ph';
    ph.textContent=`page ${pageNum}`;
    pageDiv.appendChild(ph);
  }
}

function loadVisiblePages(currentPage){
  for(let i=1;i<=pages.length;i++){
    if(Math.abs(i-currentPage)<=BUFFER) loadPage(i);
    else unloadPage(i);
  }
}

// --- Scrolling & indicator ---
function getCurrentPageFromViewport(){
  const containerRect=bookContainer.getBoundingClientRect();
  const middle=containerRect.top+containerRect.height/2;
  let closest=1,minDist=Infinity;
  pages.forEach((p,idx)=>{
    const r=p.getBoundingClientRect();
    const center=r.top+r.height/2;
    const dist=Math.abs(center-middle);
    if(dist<minDist){minDist=dist;closest=idx+1;}
  });
  return closest;
}

function updateIndicator(currentPage){
  const totalReal = TOTAL_PAGES - 7; // pages starting from 8
  const label = getPageLabel(currentPage);
  pageIndicator.textContent = label==='*'?'*':label;
  const scrollTop=bookContainer.scrollTop;
  const maxScroll=Math.max(1, bookContainer.scrollHeight-bookContainer.clientHeight);
  const ratio=scrollTop/maxScroll;
  const maxTop=window.innerHeight-pageIndicator.offsetHeight-8;
  const top=Math.max(8,Math.min(maxTop,Math.round(ratio*maxTop)));
  pageIndicator.style.top=`${top}px`;
}

function updatePageDisplay(currentPage){
  if(!isEditing){
    const totalLabel = getPageLabel(TOTAL_PAGES);
    const curLabel = getPageLabel(currentPage);
    pageInput.value = `${curLabel} / ${totalLabel}`;
  }
}

// --- Jump to page ---
function jumpToPage(pageNum){
  const num=Math.min(Math.max(1,pageNum),TOTAL_PAGES);
  const pageDiv=pages[num-1];
  if(pageDiv){
    const offsetTop=pageDiv.offsetTop-(bookContainer.clientHeight-pageDiv.clientHeight)/2;
    bookContainer.scrollTop=offsetTop;
  }
  loadVisiblePages(num);
  updateIndicator(num);
  updatePageDisplay(num);
}

// --- Scroll handling ---
let ticking=false;
bookContainer.addEventListener('scroll',()=>{if(!ticking){window.requestAnimationFrame(()=>{onScrollUpdate();ticking=false;});ticking=true;}});
function onScrollUpdate(){
  const current=getCurrentPageFromViewport();
  updateIndicator(current);
  loadVisiblePages(current);
  updatePageDisplay(current);
}

// --- Zoom ---
document.addEventListener('wheel',(e)=>{
  if(e.ctrlKey){
    e.preventDefault();
    scale+=e.deltaY*-0.004;
    scale=Math.min(Math.max(0.5,scale),2);
    zoomWrapper.style.transform=`scale(${scale})`;
    onScrollUpdate();
  } else {
    bookContainer.scrollBy({top:e.deltaY,behavior:'auto'});
  }
},{passive:false});

// --- Keyboard Navigation ---
document.addEventListener('keydown',(e)=>{
  const cur=getCurrentPageFromViewport();
  if(e.key==='ArrowDown'||e.key==='PageDown'){pages[Math.min(pages.length,cur+1)-1].scrollIntoView({behavior:'smooth',block:'center'});}
  else if(e.key==='ArrowUp'||e.key==='PageUp'){pages[Math.max(1,cur-1)-1].scrollIntoView({behavior:'smooth',block:'center'});}
});

// --- Theme Toggle ---
themeToggle.addEventListener('click',()=>{
  themeToggle.classList.toggle('active');
  darkMode=!darkMode;
  pages.forEach(p=>{
    const img=p.querySelector('img'); if(img) img.style.filter=darkMode?'invert(1) brightness(0.95) contrast(1.1)':'none';
    const ph=p.querySelector('.ph'); if(ph){ph.style.color=darkMode?'#888':'#444'; ph.style.background=darkMode?'linear-gradient(90deg,#222,#333)':'linear-gradient(90deg,#eee,#ddd)';}
  });
  onScrollUpdate();
});

// --- Toolbar show/hide ---
const toolbar=document.getElementById('toolbar');
toolbar.classList.add('visible');
let toolbarVisible=true;
document.addEventListener('click',(e)=>{if(toolbar.contains(e.target)||pageIndicator.contains(e.target)) return; toolbarVisible=!toolbarVisible; toolbar.classList.toggle('visible',toolbarVisible);});

// --- Draggable page indicator ---
let isDragging=false, offsetY=0;
pageIndicator.addEventListener('mousedown',(e)=>{isDragging=true; offsetY=e.clientY-pageIndicator.getBoundingClientRect().top; document.body.style.userSelect="none";});
document.addEventListener('mousemove',(e)=>{if(!isDragging) return; const newTop=e.clientY-offsetY; const minTop=8; const maxTop=window.innerHeight-pageIndicator.offsetHeight-8; const clampedTop=Math.max(minTop,Math.min(maxTop,newTop)); pageIndicator.style.top=`${clampedTop}px`; const scrollRatio=(clampedTop-minTop)/(maxTop-minTop); const maxScroll=bookContainer.scrollHeight-bookContainer.clientHeight; bookContainer.scrollTop=maxScroll*scrollRatio;});
document.addEventListener('mouseup',()=>{isDragging=false; document.body.style.userSelect="";});

// --- Page Input & Go Button ---
pageInput.addEventListener('focus',()=>{isEditing=true; const cur=getCurrentPageFromViewport(); pageInput.value=getPageLabel(cur); pageInput.select();});
pageInput.addEventListener('blur',()=>{isEditing=false; updatePageDisplay(getCurrentPageFromViewport());});
pageInput.addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.stopPropagation(); const val=pageInput.value.split('/')[0].trim(); const target=parsePageSpecifier(val); if(!isNaN(target)) jumpToPage(target); else updatePageDisplay(getCurrentPageFromViewport()); pageInput.blur();}});

// --- Chapters Popup ---
const CHAPTERS=[
  {title:'Unit 1 - Introducing Economics',page:8},
  {title:'Unit 2 - The Basic Economic Problems and Economic Systems',page:20},
  {title:'Unit 3 - Economic Resources and Markerts',page:36},
  {title:'Unit 4 - Introduction to Demand and Supply',page:50},
  {title:'Unit 5 - Introduction to Production and Cost',page:62},
  {title:'Unit 6 - Introduction to Money',page:74},
  {title:'Unit 7 - Introduction to Macroeconomics',page:89},
  {title:'Unit 8 - Basic Entrepreneurship',page:101},
];
const chaptersButton=toolbar.querySelector('button');
const chaptersPopup=document.getElementById('chaptersPopup');
const closeChapters=document.getElementById('closeChapters');
const chapterBoxes=document.getElementById('chapterBoxes');

chapterBoxes.innerHTML='';
const btnHeight=6;
const spacing=(100-btnHeight)/CHAPTERS.length;
CHAPTERS.forEach((ch,idx)=>{
  const btn=document.createElement('button');
  const topPercent=idx*spacing;
  btn.style.cssText=`
    position:absolute;
    top:${topPercent}%;
    left:10%;
    width:80%;
    height:${btnHeight}%;
    background:white;
    color: rgb(0, 0, 0);
    border:medium;
    border-radius:0.5vw;
    cursor:pointer;
    text-align:center;
    padding-left:1vw;
  `;
  btn.textContent=ch.title;
  btn.addEventListener('click',()=>{
    jumpToPage(ch.page);
    chaptersPopup.style.display='none';
  });
  chapterBoxes.appendChild(btn);
});

chaptersButton.addEventListener('click',(e)=>{e.stopPropagation(); chaptersPopup.style.display='block';});
closeChapters.addEventListener('click',()=>chaptersPopup.style.display='none');
document.addEventListener('click',(e)=>{if(!chaptersPopup.contains(e.target)&&e.target!==chaptersButton){chaptersPopup.style.display='none';}});

jumpToPage(1);
</script>
</body>
</html>
